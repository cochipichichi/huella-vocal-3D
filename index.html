<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Huella Vocal 3D â€” Birds (v6)</title>
<link rel="manifest" href="manifest.json"><meta name="theme-color" content="#0b0b10">
<link rel="stylesheet" href="css/styles.css?v=8.1"/><link rel="icon" href="assets/favicon.png">
<script defer src="https://cdn.jsdelivr.net/npm/plotly.js-dist-min@2.35.2/plotly.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/meyda/dist/web/meyda.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>
<header class="header"><div class="brand"><div class="logo">ğŸ•Š</div><h1>Huella Vocal 3D â€” Birds</h1></div>
<div class="controls"><button id="btnSettings" class="btn">âš™ï¸ Ajustes</button><button id="btnTheme" class="btn">ğŸŒ“ Modo</button><button id="btnContrast" class="btn">ğŸ¦¾ Alto contraste</button>
<label class="btn">ğŸ”Š Narrador <input id="toggleTTS" type="checkbox"/></label></div></header>
<div class="container"><div class="grid">
<section class="card" style="grid-column:1/-1"><h3>ğŸ›ï¸ Cargar/Seleccionar datos</h3>
<div class="subgrid">
<div class="access">
<button id="btnSample" class="btn pulse">ğŸ“¦ Usar muestra</button>
<label class="btn">ğŸ“ Cargar JSON A<input id="fileJson" type="file" accept=".json" hidden/></label>
<label class="btn">ğŸµ Cargar audio A<input id="fileAudio" type="file" accept="audio/*" hidden/></label>
<button id="btnMic" class="btn">ğŸ¤ Grabar A</button>
<span class="badge" id="status"></span>
</div>
<div class="access">
<label class="btn">ğŸ“ Cargar JSON B<input id="fileJsonB" type="file" accept=".json" hidden/></label>
<label class="btn">ğŸµ Cargar audio B<input id="fileAudioB" type="file" accept="audio/*" hidden/></label>
<button id="clearB" class="btn">ğŸ§¹ Quitar B</button>
<span class="badge" id="statusB"></span>
</div>
</div>
<p class="badge">Formato JSON: lista de objetos con campos t,x,y,z, centroid, rolloff, amp/rms, f0approx (opcionalmente centroid_norm, rolloff_norm, flatness, zcr).</p>
</section>

<section class="card" style="grid-column:1/-1"><h3>ğŸ“ˆ Nube espaciotemporal (3D)</h3>
<div class="colorbar" title="3â€“10 kHz"></div>
<div class="panel">
<label>Frame size <input id="frameSize" type="number" min="256" max="4096" step="256" value="2048"/></label>
<label>Hop <input id="hopSize" type="number" min="128" max="2048" step="128" value="512"/></label>
<label>Color scale <select id="colorScale"><option>Rainbow</option><option>Viridis</option><option>Portland</option><option>Turbo</option></select></label>
<label>cmin Hz <input id="cmin" type="number" min="0" max="20000" step="100" value="3000"/></label>
<label>cmax Hz <input id="cmax" type="number" min="1000" max="24000" step="100" value="10000"/></label>
<button id="exportBtn" class="btn">ğŸ’¾ Exportar JSON</button>
</div>
<div class="panel">
<label>ğŸ§­ Map X <select id="mapX"><option value="embed_x">embed_x</option><option value="embed_y">embed_y</option><option value="embed_z">embed_z</option><option value="centroid_norm">centroid_norm</option><option value="rolloff_norm">rolloff_norm</option><option value="flatness">flatness</option><option value="zcr">zcr</option><option value="rms">rms</option></select></label>
<label>Map Y <select id="mapY"><option value="embed_y">embed_y</option><option value="embed_x">embed_x</option><option value="embed_z">embed_z</option><option value="centroid_norm">centroid_norm</option><option value="rolloff_norm">rolloff_norm</option><option value="flatness">flatness</option><option value="zcr">zcr</option><option value="rms">rms</option></select></label>
<label>Map Z <select id="mapZ"><option value="embed_z">embed_z</option><option value="embed_x">embed_x</option><option value="embed_y">embed_y</option><option value="centroid_norm">centroid_norm</option><option value="rolloff_norm">rolloff_norm</option><option value="flatness">flatness</option><option value="zcr">zcr</option><option value="rms">rms</option></select></label>
<label>Suavizado (frames) <input id="smoothWin" type="number" min="1" max="51" step="2" value="1"/></label>
<label>Umbral RMS <input id="rmsTh" type="number" min="0" max="1" step="0.01" value="0.02"/></label>
</div>
<div id="plotWrap"><button id="btnFull" class="btn">ğŸ–µ Pantalla completa</button><button id="btnPresent" class="btn">ğŸ¬ PresentaciÃ³n</button><div id="plot"></div></div></section>

<section class="card" style="grid-column:1/-1">
  <h3>ğŸŒˆ Espectrograma sincronizado</h3>
  <div id="specWrap">
    <div class="spec-toolbar">
      <label>Fuente <select id="specSource"><option value="A">A</option><option value="B">B</option></select></label>
      <label>Rango (kHz) <input id="specMin" type="number" value="0" step="0.1"/>â€“<input id="specMax" type="number" value="11" step="0.1"/></label>
      <button id="specClear" class="btn">ğŸ§¹ Limpiar</button>
    </div>
    <canvas id="specCanvas" width="1000" height="260"></canvas>
  </div>
</section>

<section class="card" style="grid-column:1/-1">
  <h3>ğŸ§° Herramientas A/B & Anotaciones</h3>
  <div class="spec-toolbar">
    <label>ğŸ›ï¸ Perfil de anÃ¡lisis
      <select id="presetSelect" class="preset">
        <option value="default">Default</option>
        <option value="birdsong_basics">Birdsong basics</option>
        <option value="formants">Formantes</option>
        <option value="fast_trills">Trinos rÃ¡pidos</option>
        <option value="alarm_calls">Llamadas de alarma</option>
      </select>
    </label>
    <button id="saveSession" class="btn">ğŸ’¾ Guardar sesiÃ³n</button>
    <div class="history" id="history"></div>
  </div>
  <div class="grid">
    <div class="legendCard">
      <strong>Ajustes A</strong>
      <div class="legendRow"><span>Colorscale</span>
        <select id="csA"><option>Turbo</option><option>Viridis</option><option>Rainbow</option><option>Portland</option></select>
      </div>
      <div class="legendRow"><span>SÃ­mbolo</span>
        <select id="symA"><option>circle</option><option>square</option><option>diamond</option><option>cross</option></select>
      </div>
      <div class="legendRow"><span>Opacidad</span>
        <input id="opA" type="range" min="0.1" max="1" step="0.05" value="0.85"/>
      </div>
    </div>
    <div class="legendCard">
      <strong>Ajustes B</strong>
      <div class="legendRow"><span>Colorscale</span>
        <select id="csB"><option>Viridis</option><option>Turbo</option><option>Rainbow</option><option>Portland</option></select>
      </div>
      <div class="legendRow"><span>SÃ­mbolo</span>
        <select id="symB"><option>diamond</option><option>square</option><option>circle</option><option>cross</option></select>
      </div>
      <div class="legendRow"><span>Opacidad</span>
        <input id="opB" type="range" min="0.1" max="1" step="0.05" value="0.85"/>
      </div>
    </div>
    <div class="legendCard">
      <strong>Anotar intervalo</strong>
      <div class="legendRow"><span>tâ‚ (s)</span><input id="annT1" type="number" step="0.01" value="0"/></div>
      <div class="legendRow"><span>tâ‚‚ (s)</span><input id="annT2" type="number" step="0.01" value="1"/></div>
      <div class="legendRow"><span>Etiqueta</span><input id="annLabel" type="text" placeholder="Trino / llamada"/></div>
      <div class="legendRow"><button id="btnAnnotA" class="btn">â• Anotar en A</button><button id="btnAnnotB" class="btn">â• Anotar en B</button></div>
      <div class="legendRow"><button id="btnClearAnn" class="btn">ğŸ§¹ Limpiar anotaciones</button></div>
    </div>
  </div>
  <div class="metrics" style="margin-top:.6rem"><div class="box"><button id="btnPDF" class="btn">ğŸ§¾ Exportar PDF</button></div><div class="box"><button id="btnTrain" class="btn">ğŸ§  Entrenar kâ€‘NN (A/B)</button></div><div class="box"><button id="btnPredict" class="btn">ğŸ” Predecir set activo</button></div>
    <div class="box"><strong>Distancia centroides (3D)</strong><div id="mDist">â€”</div></div>
    <div class="box"><strong>DTW(centroid_norm)</strong><div id="mDTW">â€”</div></div>
    <div class="box"><strong>Frames A / B</strong><div id="mCounts">â€”</div></div>
    <div class="box"><button id="capturePng" class="btn">ğŸ“¸ Capturar PNG</button></div>
  </div>
</section>
</div></div>
<footer>Â© 2025 â€” Neotech EduLab Â· Huella Vocal 3D Â· v8 Â· <a href="pages/about.html">Acerca de</a> Â· <a href="pages/privacidad.html">Privacidad</a> Â· <a href="pages/docs.html">Docs</a> Â· <button id="btnResetCache" class="btn">ğŸ—‘ï¸ Reset cache</button></footer>
<script type="module" src="js/app.js?v=8.1"></script>
<script>if('serviceWorker'in navigator){navigator.serviceWorker.register('sw.js');}</script>

<div id="settingsModal" class="modal">
  <div class="panel">
    <h3>âš™ï¸ Ajustes</h3>
    <div class="row"><span>Tema inicial</span><select id="setTheme"><option value="dark">Oscuro</option><option value="light">Claro</option></select></div>
    <div class="row"><span>Alto contraste</span><input type="checkbox" id="setContrast"/></div>
    <div class="row"><span>Narrador</span><input type="checkbox" id="setTTS"/></div>
    <div class="row"><span>Perfil de anÃ¡lisis</span>
      <select id="setPreset"><option value="default">Default</option><option value="birdsong_basics">Birdsong basics</option><option value="formants">Formantes</option><option value="fast_trills">Trinos rÃ¡pidos</option><option value="alarm_calls">Llamadas de alarma</option></select>
    </div>
    <div class="row"><span>Map X</span><select id="setMapX"><option>embed_x</option><option>embed_y</option><option>embed_z</option><option>centroid_norm</option><option>rolloff_norm</option><option>flatness</option><option>zcr</option><option>rms</option></select></div>
    <div class="row"><span>Map Y</span><select id="setMapY"><option>embed_y</option><option>embed_x</option><option>embed_z</option><option>centroid_norm</option><option>rolloff_norm</option><option>flatness</option><option>zcr</option><option>rms</option></select></div>
    <div class="row"><span>Map Z</span><select id="setMapZ"><option>embed_z</option><option>embed_x</option><option>embed_y</option><option>centroid_norm</option><option>rolloff_norm</option><option>flatness</option><option>zcr</option><option>rms</option></select></div>
    <div class="row"><span>Suavizado</span><input id="setSmooth" type="number" min="1" max="51" step="2" value="1"/></div>
    <div class="row"><span>Umbral RMS</span><input id="setRmsTh" type="number" min="0" max="1" step="0.01" value="0.02"/></div>
    <div class="row"><span>Colorscale</span><select id="setCS"><option>Rainbow</option><option>Viridis</option><option>Portland</option><option>Turbo</option></select></div>
    <div class="row"><span>PresentaciÃ³n al abrir</span><input type="checkbox" id="setPresentation"/></div>
    <div class="row" style="justify-content:flex-end;gap:.5rem"><button id="setReset" class="btn">Restablecer</button><button id="setCancel" class="btn">Cancelar</button><button id="setSave" class="btn">Guardar</button></div>
  </div>
</div>

<script>
(async function(){
  const btn = document.getElementById('btnResetCache');
  if(!btn) return;
  btn.addEventListener('click', async ()=>{
    try{
      if('caches' in window){
        const keys = await caches.keys();
        await Promise.all(keys.map(k=>caches.delete(k)));
      }
      if(navigator.serviceWorker){
        const regs = await navigator.serviceWorker.getRegistrations();
        await Promise.all(regs.map(r=>r.unregister()));
      }
      localStorage.clear(); sessionStorage.clear(); location.reload(true);
    }catch(e){ alert('No se pudo limpiar: '+e); }
  });
})();
</script>

</body></html>